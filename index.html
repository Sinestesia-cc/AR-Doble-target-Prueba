<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AR Experience</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background: #000;
        }
        #unity-canvas {
            width: 100%;
            height: 100%;
            background: transparent;
        }
        #video-canvas {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
        }
    </style>
</head>
<body>
    <video id="webcam-video" muted autoplay playsinline style="display:none"></video>
    <canvas id="video-canvas"></canvas>
    
    <div id="unity-container">
        <canvas id="unity-canvas"></canvas>
    </div>

    <script src="arcamera.js"></script>
    <script src="itracker.js"></script>
    <script src="Build/c4c617d74cb9d73dd7036720d3475599.loader.js"></script>

    <script>
        // Configuración mínima
        const WEBCAM_SETTINGS = {
            video: {
                facingMode: 'environment',
                width: { ideal: 640 },
                height: { ideal: 480 }
            }
        };

        // Inicialización directa
        async function initializeAR() {
            try {
                const unityCanvas = document.getElementById('unity-canvas');
                const videoCanvas = document.getElementById('video-canvas');
                
                window.arCamera = new ARCamera(unityCanvas, videoCanvas);
                window.iTracker = new ImageTracker(arCamera);
                
                await iTracker.initialize("./opencv.js");
                await startCamera();
                initUnity();
                
            } catch(error) {
                console.error('Error inicialización:', error);
            }
        }

        async function startCamera() {
            const stream = await navigator.mediaDevices.getUserMedia(WEBCAM_SETTINGS);
            const video = document.getElementById('webcam-video');
            video.srcObject = stream;
            await arCamera.startWebcam(video);
        }

        function initUnity() {
            createUnityInstance(document.getElementById('unity-canvas'), {
                dataUrl: "Build/6f15aa496fc7aed21e074e35a99a58d7.data",
                frameworkUrl: "Build/18b6ba94afa8d1af90b4b151dd6b0da4.framework.js",
                codeUrl: "Build/6b1f320e7020949b0fb210d5b26cc57c.wasm",
                streamingAssetsUrl: "StreamingAssets",
                companyName: "Sinestesia",
                productName: "AR Cintac",
                productVersion: "1.4.0"
            }, (progress) => {
                // Barra de progreso opcional
            }).then((unityInstance) => {
                window.unityInstance = unityInstance;
            });
        }

        // Iniciar todo al cargar
        window.addEventListener('load', initializeAR);
    </script>
</body>
</html>